<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="PROJECT">
	<insert id="insertProject" parameterClass="com.boco.workflow.webservice.pojo.Project">
		INSERT INTO 
		T_WF_PROJECT 
		( SETUP_NAME          ,
		  SETUP_CODE         ,
		  SETUP_REQFILE_CODE ,
		  SETUP_REQER_NAME   ,
		  SETUP_REQER_PHONE  ,
		  SETUP_REQ_DATE     ,
		  PRJ_NAME           ,
		  PRJ_CODE           ,
		  PRJ_CATEGORY       ,
		  PRJ_TYPE           ,
		  PRJ_STATUS         ,
		  COST               ,
		  LENGTH             ,
		  DOMAIN_NAME        ,
		  PRJ_DESC           ,
		  FTP_NAME           ,
		  PARENT_PRJ_CODE    ,
		  CUID               ,
		  CREATE_TIME        ,
		  LAST_MODIFY_TIME )
		values 
		( #setupName#         ,
		  #setupCode#        ,
		  #setupReqFileCode# ,
		  #setupReqerName#   ,
		  #setupReqerPhone#  ,  
		  #setupReqDate#     ,
		  #prjName#          ,
		  #prjCode#          ,
		  #prjCategory#      ,
		  #prjType#          ,
		  #prjStatus#        ,
		  #cost#             ,
		  #length#           ,
		  #domainName#       ,
		  #prjDesc#          ,
		  #ftpName#          ,
		  #parentPrjCode#    ,
		  #cuid#             ,
		  sysdate            ,
		  sysdate)
	</insert>
	
	<update id="updateProjectStatus" parameterClass="com.boco.workflow.webservice.pojo.PrjStatus">
		update T_WF_PROJECT p
			set prj_status = #prjStatus# ,
				username = #userName# ,
				LAST_MODIFY_TIME = sysdate
		where p.cuid = #cuid# 
	</update>
	
	<select id="queryProjectByCode" parameterClass="java.lang.String" resultClass="com.boco.core.ibatis.vo.ResultMap">
		select 
				 SETUP_NAME         ,
				 SETUP_CODE         ,
				 SETUP_REQFILE_CODE ,
				 SETUP_REQER_NAME   ,
				 SETUP_REQER_PHONE  ,
				 SETUP_REQ_DATE     ,
				 PRJ_NAME           ,
				 PRJ_CODE           ,
				 PRJ_CATEGORY       ,
				 PRJ_TYPE           ,
				 COST               ,
				 LENGTH             ,
				 DOMAIN_NAME        ,
				 PRJ_DESC           ,
				 nvl(FTP_NAME, (select FTP_NAME from T_WF_PROJECT tt where t.PARENT_PRJ_CODE = tt.PRJ_CODE))    FTP_NAME       ,
				 PARENT_PRJ_CODE    ,
				 CUID               ,
				 CREATE_TIME        ,
				 USERNAME           ,
				 PRJ_STATUS         ,
				 LAST_MODIFY_TIME   
			from T_WF_PROJECT t where CUID = #cuid#
	</select>
	
	<insert id="movePos" parameterClass="com.boco.workflow.webservice.pojo.ProjectNameSpace">
		insert into $ns$an_pos select * from t_attemp_an_pos t where t.related_project_cuid = #prjcode#
	</insert>
	
	<insert id="moveOnu" parameterClass="com.boco.workflow.webservice.pojo.ProjectNameSpace">
		insert into $ns$an_onu select * from t_attemp_an_onu t where t.related_project_cuid = #prjcode#
	</insert>
	
	<insert id="moveCard" parameterClass="com.boco.workflow.webservice.pojo.ProjectNameSpace">
		insert into $ns$card select * from t_attemp_card t where t.related_device_cuid in(
		 	select cuid from t_attemp_an_onu t where t.related_project_cuid = #prjcode#
			union all
			select cuid from t_attemp_an_pos t where t.related_project_cuid = #prjcode#
		 )
	</insert>
	
	<insert id="moveAddress" parameterClass="com.boco.workflow.webservice.pojo.ProjectNameSpace">
		insert into $ns$t_rofh_full_address select * from t_attemp_t_rofh_full_address t where t.related_project_cuid = #prjcode#
	</insert>
	
	<insert id="moveCover" parameterClass="com.boco.workflow.webservice.pojo.ProjectNameSpace">
		insert into $ns$gpon_cover select * from t_attemp_gpon_cover t where t.related_project_cuid = #prjcode#
	</insert>
	<insert id="moveCommunity" parameterClass="com.boco.workflow.webservice.pojo.ProjectNameSpace">
		insert into $ns$BUSINESS_COMMUNITY select * from t_attemp_BUSINESS_COMMUNITY t where t.related_project_cuid = #prjcode#
	</insert>
	<insert id="movePtp" parameterClass="com.boco.workflow.webservice.pojo.ProjectNameSpace">
		insert into $ns$ptp select * from t_attemp_ptp t where t.related_ne_cuid in(
			select cuid from t_attemp_an_onu t where t.related_project_cuid = #prjcode#
			union all
			select cuid from t_attemp_an_pos t where t.related_project_cuid = #prjcode#
		)
	</insert>
	
	<delete id="deleteAttempOnu" parameterClass="java.lang.String">
		delete from  t_attemp_an_onu where related_project_cuid = #prjcode#
	</delete>
	
	<delete id="deleteAttempPos" parameterClass="java.lang.String">
		delete from  t_attemp_an_pos where related_project_cuid = #prjcode#
	</delete>
	
	<delete id="deleteAttempCover" parameterClass="java.lang.String">
		delete from  t_attemp_gpon_cover where related_project_cuid = #prjcode#
	</delete>
	
	<delete id="deleteAttempAddress" parameterClass="java.lang.String">
		delete from  t_attemp_t_rofh_full_address where related_project_cuid = #prjcode#
	</delete>
	
	<delete id="deleteAttempCommunity" parameterClass="java.lang.String">
		delete from  t_attemp_BUSINESS_COMMUNITY where related_project_cuid = #prjcode#
	</delete>
	
	<delete id="deleteAttempPtp" parameterClass="java.lang.String">
		delete from  t_attemp_ptp where related_ne_cuid in(
			select cuid from t_attemp_an_onu t where t.related_project_cuid = #prjcode#
			union all
			select cuid from t_attemp_an_pos t where t.related_project_cuid = #prjcode#
		)
	</delete>
	
	<delete id="deleteAttempCard" parameterClass="java.lang.String">
		delete from  t_attemp_card where related_device_cuid in(
		 	select cuid from t_attemp_an_onu t where t.related_project_cuid = #prjcode#
			union all
			select cuid from t_attemp_an_pos t where t.related_project_cuid = #prjcode#
		 )
	</delete>
	
	<insert id="insertHanging" parameterClass="java.lang.String">
	<![CDATA[ 
		insert into T_WF_FTTX_GC
			select 
			seq_WF_FTTX_GC.Nextval,
			 REGIONCODE       ,
			  DEVICENAME       ,
			  OLTFACTORY       ,
			  DNSUBNECODE      ,
			  DNPACKAGECODE    ,
			  OLTSLOT          ,
			  PORTNO           ,
			  VILLAGE_NAME     ,
			  VILLAGE_ID       ,
			  PRJCODE          ,
			  prjname          ,
			  PARENTPRJCODE    ,
			  OLTTELENETIPADDR ,
			  OLTIDINEMS       ,
			  UPBASIP          ,
			  UPBASSLOT        ,
			  UPBASPACKAGE     ,
			  UPBASPORT        ,
			  OLTSVLAN         ,
			  OLTCVLAN         ,
			  SPLITRATIO       ,
			  SPLITLEVEL       ,
			  PARENT_NAME      ,
			  ptp.label_cn PARENT_OBDCODE   ,
			  PASSWORD         ,
			  DEVICE_TYPE      ,
			  OPERATIONTYPE    ,
			  OPERATIONTIME    ,
			  RESULT           ,
			  OPT_POWER        ,
			  FAILDESC         ,
			  CALL_RESULT      ,
			  ponportname      ,
			  ''
			  from v_fttx_gc vg ,t_attemp_ptp ptp
			 where ptp.related_ne_cuid = vg.pos_cuid
			 and ptp.port_sub_type = 13
			 and vg.cuid = #cuid#
			]]>
	</insert>
	<delete id="deleteHanging" parameterClass="java.util.Map">
		delete from  T_WF_FTTX_GC where PRJCODE = #PRJ_CODE#
		 and PARENTPRJCODE = #PARENT_PRJ_CODE#
	</delete>
	
	<update id="updateHanging" parameterClass="java.util.Map">
		update T_WF_FTTX_GC p
		   set password = #password#,
			   jh_result = #reason#
		 where ponportname = #ponPort#
	</update>
	
	<update id="updateResultStatus" parameterClass="java.util.Map">
			update  T_WF_FTTX_GC
				set result = 0
			where PRJCODE = #PRJ_CODE#
			     and PARENTPRJCODE = #PARENT_PRJ_CODE#
	</update>
	
	<select id="getIdByCode" resultClass="java.lang.String" parameterClass="com.boco.workflow.webservice.pojo.PrjStatus">
		select cuid from t_wf_project where PRJ_CODE = #prjCode# 
			<isEmpty property="parentPrjCode">
			AND PARENT_PRJ_CODE IS NULL
			</isEmpty>
			<isNotEmpty property="parentPrjCode">
			AND PARENT_PRJ_CODE = #parentPrjCode#
			</isNotEmpty>
	</select>
	
	<delete id="deleteProject" parameterClass="java.lang.String">
		delete from t_wf_project where cuid = #id#
	</delete>
	
	<update id="updateProject" parameterClass="com.boco.workflow.webservice.pojo.Project">
		update t_wf_project
			set 		  SETUP_NAME         = #setupName#         ,
		  SETUP_CODE         = #setupCode#        ,
		  SETUP_REQFILE_CODE = #setupReqFileCode# ,
		  SETUP_REQER_NAME   = #setupReqerName#   ,
		  SETUP_REQER_PHONE  = #setupReqerPhone#  ,  
		  SETUP_REQ_DATE     = #setupReqDate#     ,
		  PRJ_NAME           = #prjName#          ,
		  PRJ_CODE           = #prjCode#          ,
		  PRJ_CATEGORY       = #prjCategory#      ,
		  PRJ_TYPE           = #prjType#          ,
		  COST               = #cost#             ,
		  LENGTH             = #length#           ,
		  DOMAIN_NAME        = #domainName#       ,
		  PRJ_DESC           = #prjDesc#          ,
		  FTP_NAME           = #ftpName#          ,
		  PARENT_PRJ_CODE    = #parentPrjCode#    ,
		  LAST_MODIFY_TIME   = sysdate
		where cuid = #cuid#
	</update>
	
	<select id="queryActiveByCuidAndStatus" parameterClass="java.util.Map" resultClass="com.boco.core.ibatis.vo.ResultMap">
		select cuid from t_wf_project where cuid = #cuid# and prjStatus= #prjStatus#
	</select>
	<select id="queryActiveByCuid" parameterClass="java.lang.String" resultClass="com.boco.core.ibatis.vo.ResultMap">
		select distinct wp.cuid,
                olt.label_dev,
                olt.label_cn as DEVICENAME,
                substr(olt.fdn, 5, instr(olt.fdn, ':', 1) - 5) as OLTEMS,
                p.label_cn as PONPORTNAME,
               (select distinct gc.password from t_wf_fttx_gc gc where gc.ponportname = p.label_cn) PASSWORD,
                p.svlan OLTSVLAN,
                '200' OLTCVLAN,
                (select label_cn
                   from device_vendor
                  where device_vendor.cuid = olt.related_vendor_cuid) OLTFACTORY
	  from trans_element olt, ptp p, t_attemp_an_pos pos, t_wf_project wp
	 where olt.cuid = pos.related_olt_cuid
	   and p.cuid = pos.related_port_cuid
	   and pos.related_project_cuid = wp.cuid
	   and wp.cuid =#CUID#
	</select>
	<select id="queryActiveByPrjcode" parameterClass="java.util.Map" resultClass="java.lang.String">
		select  wp.cuid from  t_wf_project wp where wp.PRJ_CODE =#code# and PARENT_PRJ_CODE = #pcode#
	</select>
	<insert id="insertProjectStatusRecord" parameterClass="java.util.Map">
		insert into T_WF_PRJ_STATUS_RECORD(prj_id,prj_status,update_time)
		values(#id#,#status#,sysdate)
    </insert>
</sqlMap>